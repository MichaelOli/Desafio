# Fontes de Dados: Reais vs Simulados 

## Vis√£o Geral

O sistema possui **3 fontes de dados** diferentes que s√£o usadas em uma **hierarquia de prioridade**:

```
1. DADOS REAIS DO ERP.json (Prioridade Alta)
2. DADOS REAIS DO DATA LAKE (Prioridade M√©dia)  
3. DADOS SIMULADOS (Fallback)
```

---

## **1. DADOS REAIS DO ERP.json**

### **Localiza√ß√£o:**
```
dados/ERP.json
```

### **Conte√∫do Real:**
```json
{
  "guestCheckId": "12345678-1234-5678-9012-123456789012",
  "chkNum": 1001,
  "opnBusDt": "2024-01-15",
  "chkTtl": 50.05,
  "gstCnt": 2,
  "detailLines": [
    {
      "menuItem": {
        "itemName": "Hamb√∫rguer Artesanal",
        "categoryName": "Lanches",
        "unitPrice": 38.90
      }
    },
    {
      "menuItem": {
        "itemName": "Pizza Margherita", 
        "categoryName": "Pizzas",
        "unitPrice": 22.75
      }
    }
  ]
}
```

### **Dados Extra√≠dos:**
- **Itens reais:** Hamb√∫rguer Artesanal, Pizza Margherita
- **Data:** 2024-01-15 (janeiro de 2024)
- **Mesa:** Mesa 12
- **Total:** R$ 50.05
- **Registros:** 4 (2 itens + 1 desconto + 1 imposto)

### **Como √© Processado:**
```python
# src/extrair.py - linha ~100
def extrair_dados_erp_restaurante(self):
    dados_erp = self.extrair_json("dados/ERP.json")
    # Processa cada item do menu, desconto e imposto
    # Retorna DataFrame com dados estruturados
```

---

## **2. DADOS REAIS DO DATA LAKE**

### **Localiza√ß√£o:**
```
dados/data_lake/dados_brutos/
‚îú‚îÄ‚îÄ bilgetFiscalInvoice/ano=2025/mes=07/dia=31/loja=loja001/
‚îú‚îÄ‚îÄ getGuestChecks/ano=2025/mes=07/dia=31/loja=loja001/
‚îú‚îÄ‚îÄ getChargeBack/ano=2025/mes=07/dia=31/loja=loja001/
‚îú‚îÄ‚îÄ getTransactions/ano=2025/mes=07/dia=31/loja=loja001/
‚îî‚îÄ‚îÄ getCashManagementDetails/ano=2025/mes=07/dia=31/loja=loja001/
```

### **Conte√∫do Real (Exemplo):**
```json
{
  "metadados": {
    "endpoint": "getCashManagementDetails",
    "data_negocio": "2025-07-31",
    "id_loja": "loja001"
  },
  "dados": {
    "cashManagementId": "CM-2024-001",
    "storeId": "loja001", 
    "openingBalance": 500.0,
    "closingBalance": 750.0,
    "totalSales": 1250.0
  }
}
```

### **Dados Extra√≠dos:**
- **5 endpoints:** bilgetFiscalInvoice, getGuestChecks, getChargeBack, getTransactions, getCashManagementDetails
- **Data:** 2025-07-31 (julho de 2025)
- **Loja:** loja001
- **Registros:** 15 arquivos (3 de cada endpoint)

### **Como √© Processado:**
```python
# src/extrair.py - linha ~360
def extrair_dados_data_lake(self):
    # Busca todos os arquivos JSON nos 5 endpoints
    # Extrai metadados + dados de cada arquivo
    # Consolida em DataFrame √∫nico
```

---

## **3. DADOS SIMULADOS**

### **Localiza√ß√£o:**
```
Gerados em mem√≥ria pelo c√≥digo Python
```

### **Conte√∫do Simulado:**
```python
# src/extrair.py - linha ~220
itens_menu = [
    {'nome': 'Hamb√∫rguer Artesanal', 'categoria': 'Lanches', 'preco': 22.75},
    {'nome': 'Pizza Margherita', 'categoria': 'Pizzas', 'preco': 28.50},
    {'nome': 'Lasanha Bolonhesa', 'categoria': 'Massas', 'preco': 24.90},
    {'nome': 'Salm√£o Grelhado', 'categoria': 'Peixes', 'preco': 35.00},
    # ... mais itens realistas
]

funcionarios = [
    {'id': 1001, 'nome': 'Maria Silva'},
    {'id': 1002, 'nome': 'Jo√£o Santos'},
    # ... mais funcion√°rios
]
```

### **Dados Gerados:**
- **Per√≠odo:** √öltimos 90 dias (m√∫ltiplas datas)
- **Comandas:** 200 comandas simuladas
- **Itens:** 10 itens diferentes do menu
- **Funcion√°rios:** 5 funcion√°rios diferentes
- **Mesas:** 1-20 (aleat√≥rio)
- **Registros:** ~800-1000 (dependendo dos itens por comanda)

### **Como √© Gerado:**
```python
# src/extrair.py - linha ~220
def gerar_dados_exemplo_restaurante(self, numero_comandas=200):
    # Gera comandas aleat√≥rias com:
    # - Datas dos √∫ltimos 90 dias
    # - 1-5 itens por comanda
    # - Funcion√°rios e mesas aleat√≥rios
    # - 20% das comandas t√™m desconto
```

---

## **L√≥gica de Decis√£o: Qual Fonte Usar?**

### **Algoritmo de Prioridade:**

```python
# src/extrair.py - linha ~430
def extrair_dados_combinados_restaurante(self):
    
    # 1. TENTAR ERP.json
    try:
        dados_erp = self.extrair_dados_erp_restaurante()
        if not dados_erp.empty:
            return dados_erp  
    except:
        pass
    
    # 2. TENTAR DATA LAKE  
    try:
        dados_data_lake = self.extrair_dados_data_lake()
        if not dados_data_lake.empty:
            return processar_data_lake(dados_data_lake)  
    except:
        pass
    
    # 3. FALLBACK: DADOS SIMULADOS
    return self.gerar_dados_exemplo_restaurante(200)  
```

### **Cen√°rios Pr√°ticos:**

#### **Cen√°rio 1: Projeto Completo (Atual)**
```
ERP.json existe ‚Üí USA DADOS REAIS DO ERP
Resultado: Hamb√∫rguer Artesanal, Pizza Margherita, 2024-01
```

#### **Cen√°rio 2: S√≥ Data Lake**
```
ERP.json n√£o existe
Data Lake existe ‚Üí USA DADOS REAIS DO DATA LAKE  
Resultado: Dados dos 5 endpoints, 2025-07
```

#### **Cen√°rio 3: Projeto Vazio**
```
ERP.json n√£o existe
Data Lake n√£o existe ‚Üí USA DADOS SIMULADOS
Resultado: 200 comandas, m√∫ltiplos meses, 10 itens variados
```

---

## **Controle no Dashboard**

### **Checkbox "Usar dados reais do ERP/Data Lake":**

#### **Marcado (Padr√£o):**
```python
usar_dados_reais = True
dados_df = carregar_dados_restaurante(usar_dados_reais=True)
# ‚Üí Executa algoritmo de prioridade acima
```

#### **Desmarcado:**
```python  
usar_dados_reais = False
dados_df = carregar_dados_restaurante(usar_dados_reais=False)
# ‚Üí For√ßa uso de dados simulados
```

---

## üìä **Compara√ß√£o das Fontes**

| Aspecto | ERP.json | Data Lake | Simulados |
|---------|----------|-----------|-----------|
| **Realismo** | 100% Real | 100% Real | Realista |
| **Volume** | Poucos dados | M√©dio | Muitos dados |
| **Per√≠odos** | 1 m√™s | 1 m√™s | 3 meses |
| **Tend√™ncias** | Imposs√≠vel | Imposs√≠vel | Poss√≠vel |
| **Correla√ß√µes** | Limitadas | Limitadas | Ricas |
| **Insights** | B√°sicos | B√°sicos | Avan√ßados |

---

## **Como Verificar Qual Fonte Est√° Sendo Usada**

### **1. Logs do Sistema:**
```bash
python demo_streamlit.py

# Sa√≠da mostra a fonte:
INFO:src.extrair:Dados ERP extra√≠dos: 4 registros  ‚Üê ERP.json
INFO:src.extrair:Dados data lake extra√≠dos: 15 registros  ‚Üê Data Lake  
INFO:src.extrair:Gerando dados simulados para demonstra√ß√£o  ‚Üê Simulados
```

### **2. Dashboard:**
```
Fonte dos dados: Dados Reais (ERP + Data Lake)  ‚Üê Reais
Fonte dos dados: Dados Simulados  ‚Üê Simulados
```

### **3. Dados Espec√≠ficos:**
```
ERP.json: Hamb√∫rguer Artesanal, Pizza Margherita, 2024-01
Simulados: Lasanha Bolonhesa, Salm√£o Grelhado, m√∫ltiplas datas
```

---

## **Recomenda√ß√µes de Uso**

### **Para Testar Funcionalidades:**
```
Desmarque "Usar dados reais"
‚Üí Veja an√°lise completa com tend√™ncias e correla√ß√µes
```

### **Para Dados Reais do Neg√≥cio:**
```
Marque "Usar dados reais"  
‚Üí Veja dados reais do ERP, mesmo que limitados
```

### **Para Demonstra√ß√µes:**
```
Alterne entre os dois para mostrar:
- Dados reais: Autenticidade
- Dados simulados: Funcionalidades completas
```

---

## **Resumo**

**O sistema √© inteligente e flex√≠vel:**

1. **Prioriza dados reais** quando dispon√≠veis
2. **Fallback autom√°tico** para dados simulados
3. **Controle manual** via checkbox
4. **Transpar√™ncia total** sobre qual fonte est√° sendo usada

**Resultado:** Voc√™ sempre tem dados para analisar, sejam reais ou simulados, com total controle e visibilidade sobre a fonte!

---

## **Insights Autom√°ticos:**

### **N√ÉO √â INTELIG√äNCIA ARTIFICIAL**

Os "insights autom√°ticos" s√£o gerados por **regras program√°ticas simples**, n√£o por IA:

```python
# Exemplo real do c√≥digo:
def gerar_insights_automaticos(self, dados_df):
    insights = []
    
    # 1. Ranking simples
    item_top = dados_df.groupby('nome_item')['valor_item'].sum().idxmax()
    insights.append(f"O item mais vendido em valor √©: {item_top}")
    
    # 2. Classifica√ß√£o por limiar
    ticket_medio = dados_df.groupby('guest_check_id')['valor_item'].sum().mean()
    if ticket_medio > 100:
        insights.append("O ticket m√©dio √© alto, indicando bom valor por comanda")
    else:
        insights.append("O ticket m√©dio √© moderado, foco em aumentar itens")
    
    # 3. Identifica√ß√£o de padr√µes
    mes_pico = dados_df.groupby(dados_df['data_abertura'].dt.month)['valor_item'].sum().idxmax()
    insights.append(f"O m√™s com maior faturamento √© {meses[mes_pico-1]}")
    
    return insights
```

### **Tipos de "Insights" Gerados:**

| Tipo | Exemplo | M√©todo |
|------|---------|--------|
| **Rankings** | "Item mais vendido: Hamb√∫rguer" | `groupby().sum().idxmax()` |
| **Classifica√ß√µes** | "Ticket m√©dio √© alto (R$ 45.50)" | `if valor > limiar` |
| **Padr√µes Temporais** | "M√™s de pico: Janeiro" | `groupby(mes).sum().idxmax()` |
| **Compara√ß√µes** | "Mesa 12 tem maior faturamento" | `groupby().sum().sort_values()` |

### **O que √â (Regras Program√°ticas):**
- Agrega√ß√µes SQL simples (GROUP BY, MAX, AVG)
- Condicionais if/else b√°sicas
- Templates de texto pr√©-definidos
- Estat√≠sticas descritivas

### **O que N√ÉO √â (IA Real):**
- Aprendizado de m√°quina
- Redes neurais
- Processamento de linguagem natural
- An√°lise preditiva complexa
- Reconhecimento de padr√µes avan√ßados

### **Exemplo de Sa√≠da Real:**
```
Insights Autom√°ticos:
1. O m√™s com maior faturamento √© Jan
2. O item mais vendido em valor √©: Hamb√∫rguer Artesanal  
3. A categoria com melhor performance √©: Lanches
4. O funcion√°rio com melhor performance √©: Maria Silva
5. O ticket m√©dio √© moderado (R$ 45.50), foco em aumentar itens por comanda
6. A mesa com maior faturamento √© a Mesa 12
7. O pre√ßo m√©dio dos itens √© acess√≠vel (R$ 22.75), foco em volume
8. O dia da semana com maior movimento √© Segunda-feira
```

**Conclus√£o:** S√£o "insights autom√°ticos inteligentes" mas baseados em regras simples, n√£o em IA!

---

## **An√°lise de Correla√ß√£o: Como Funciona**

### **Matriz de Correla√ß√£o Melhorada**

A an√°lise de correla√ß√£o tamb√©m **n√£o usa IA**, mas sim **estat√≠stica tradicional**:

```python
# C√°lculo de correla√ß√£o (Pearson)
correlacao = dados_df[colunas_numericas].corr()

# Interpreta√ß√£o autom√°tica
for i, j in correlacao:
    valor_corr = correlacao.iloc[i, j]
    if valor_corr > 0.7:
        tipo = "Correla√ß√£o muito forte positiva"
        explicacao = f"Quando {var1} aumenta, {var2} tamb√©m aumenta significativamente"
```

### **Melhorias Implementadas:**

1. preco_unitario ‚Üî valor_item
   Correla√ß√£o muito forte positiva (0.85)
   Quando preco_unitario aumenta, valor_item tamb√©m aumenta significativamente

Insights Pr√°ticos:
Itens com pre√ßos mais altos geram maior faturamento - considere estrat√©gias de upselling
```

### **Processo de Interpreta√ß√£o:**

1. **C√°lculo:** Correla√ß√£o de Pearson entre vari√°veis num√©ricas
2. **Filtragem:** Apenas correla√ß√µes > 0.3 (significativas)
3. **Classifica√ß√£o:** Por for√ßa da correla√ß√£o
4. **Interpreta√ß√£o:** Templates baseados em regras
5. **Insights:** Sugest√µes pr√°ticas para restaurante

---

## **An√°lise de Tend√™ncias: Limita√ß√µes dos Dados Reais**

### **Problema Identificado:**

```
Dados Atuais:
- ERP.json: 2024-01-15 (janeiro de 2024)
- Data Lake: 2025-07-31 (julho de 2025)
- Resultado: Apenas 1 per√≠odo ap√≥s limpeza

An√°lise de Tend√™ncias:
Melhor Per√≠odo: 2024-01 (R$ 45.50)
Pior Per√≠odo: 2024-01 (R$ 45.50)  ‚Üê Iguais!
```

### **Solu√ß√£o Implementada:**

#### **Interface Melhorada:**
```
Dados Insuficientes para An√°lise de Tend√™ncias

Atualmente temos dados de apenas 1 per√≠odo (2024-01).

Para uma an√°lise de tend√™ncias significativa, precisamos de dados de m√∫ltiplos meses.

Sugest√µes:
- Aguarde mais dados hist√≥ricos serem coletados
- Use dados simulados (desmarque "Usar dados reais") para ver como funcionaria
- Considere analisar tend√™ncias di√°rias ao inv√©s de mensais
```

#### **Compara√ß√£o Visual:**
```
Melhor Per√≠odo: 2024-01 (R$ 45.50)
Per√≠odo √önico: 2024-01 (R$ 45.50)
Apenas um per√≠odo dispon√≠vel  ‚Üê Explica√ß√£o clara!
```

### **Recomenda√ß√£o:**
Para ver an√°lise de tend√™ncias completa, use **dados simulados** que cobrem 90 dias com m√∫ltiplas datas.

---

## **Processamento e Transforma√ß√£o de Dados**

### **Pipeline ETL Completo:**

```
1. EXTRACT (Extrair)
   ‚îú‚îÄ‚îÄ ERP.json ‚Üí 4 registros (2 itens + 1 desconto + 1 imposto)
   ‚îú‚îÄ‚îÄ Data Lake ‚Üí 15 registros (5 endpoints √ó 3 arquivos)
   ‚îî‚îÄ‚îÄ Simulados ‚Üí 800-1000 registros (200 comandas)

2. TRANSFORM (Transformar)
   ‚îú‚îÄ‚îÄ Limpeza: Remove registros inv√°lidos
   ‚îú‚îÄ‚îÄ Padroniza√ß√£o: Nomes, datas, valores
   ‚îú‚îÄ‚îÄ Enriquecimento: Colunas derivadas (ano, m√™s, dia_semana)
   ‚îî‚îÄ‚îÄ Valida√ß√£o: Constraints de neg√≥cio

3. LOAD (Carregar)
   ‚îú‚îÄ‚îÄ DataFrame estruturado
   ‚îú‚îÄ‚îÄ M√©tricas calculadas
   ‚îî‚îÄ‚îÄ Pronto para an√°lise
```

### **Exemplo de Transforma√ß√£o:**

#### **Dados Brutos (ERP.json):**
```json
{
  "detailLines": [{
    "menuItem": {
      "itemName": "Hamb√∫rguer Artesanal",
      "unitPrice": 22.75,
      "dspQty": 1
    }
  }]
}
```

#### **Dados Transformados:**
```python
{
  'nome_item': 'Hamb√∫rguer Artesanal',
  'preco_unitario': 22.75,
  'quantidade': 1,
  'valor_item': 22.75,
  'categoria': 'Lanches',
  'ano': 2024,
  'mes': 1,
  'dia_semana': 'Monday',
  'ticket_comanda': 45.50
}
```

---

## **Controles Avan√ßados do Dashboard**

### **Filtros Din√¢micos:**

```python
# Filtros espec√≠ficos para restaurante
filtros_disponiveis = {
    'item_menu': dados_df['nome_item'].unique(),
    'categoria': dados_df['categoria'].unique(), 
    'funcionario': dados_df['nome_funcionario'].unique(),
    'mesa': dados_df['numero_mesa'].unique()
}

# Aplica√ß√£o de filtros
dados_filtrados = dados_df.copy()
if item_selecionado != 'Todos':
    dados_filtrados = dados_filtrados[dados_filtrados['nome_item'] == item_selecionado]
```

### **M√©tricas Calculadas em Tempo Real:**

```python
# M√©tricas principais
metricas = {
    'faturamento_total': dados_filtrados['valor_item'].sum(),
    'total_comandas': dados_filtrados['guest_check_id'].nunique(),
    'ticket_medio': dados_filtrados.groupby('guest_check_id')['valor_item'].sum().mean(),
    'itens_vendidos': len(dados_filtrados)
}
```
## **Performance e Otimiza√ß√µes**

### **Cache Inteligente:**

```python
@st.cache_data
def carregar_dados_restaurante(usar_dados_reais=True):
    # Dados s√£o carregados apenas uma vez
    # Recarregados apenas quando par√¢metros mudam
```

### **Filtragem Eficiente:**

```python
# Filtros aplicados em sequ√™ncia otimizada
dados_filtrados = dados_df.copy()
for filtro, valor in filtros_ativos.items():
    if valor != 'Todos':
        dados_filtrados = dados_filtrados[dados_filtrados[filtro] == valor]
```

### **Processamento Sob Demanda:**

```python
# M√©tricas calculadas apenas quando necess√°rio
if tab_selecionada == 'tendencias':
    tendencias = analisador.analisar_tendencias(dados_filtrados)
elif tab_selecionada == 'correlacoes':
    correlacoes = analisador.criar_heatmap_correlacao(dados_filtrados)
```

---

## **Resumo T√©cnico Completo**

### **Arquitetura:**
```
Interface (Streamlit) 
    ‚Üì
Controle de Dados (app_streamlit.py)
    ‚Üì
Pipeline ETL (src/)
    ‚îú‚îÄ‚îÄ Extrair (extrair.py) ‚Üí ERP.json + Data Lake + Simulados
    ‚îú‚îÄ‚îÄ Transformar (transformar.py) ‚Üí Limpeza + Enriquecimento  
    ‚îî‚îÄ‚îÄ Analisar (analisar.py) ‚Üí Insights + Correla√ß√µes + Tend√™ncias
    ‚Üì
Visualiza√ß√£o (Plotly + Streamlit)
```

### **Funcionalidades:**
- **3 fontes de dados** com prioriza√ß√£o autom√°tica
- **Insights autom√°ticos** baseados em regras (n√£o IA)
- **Correla√ß√µes intuitivas** com interpreta√ß√£o autom√°tica
- **An√°lise de tend√™ncias** com tratamento de dados insuficientes
- **Dashboard interativo** com filtros din√¢micos
- **Cache inteligente** para performance


